%! Author = Administrator
%! Date = 2021/7/2

\chapter{项目相关平台介绍}
本章主要梳理介绍与本文紧密关联的云平台环境。在本章，我们将对项目相关的底层设施与运行的平台进行综合的介绍阐述。
\cite{ipacfteaom1}
\section{应用与服务编排工作流项目的相关技术介绍}
应用与服务编排工作流是一种新型智能化编排工具，用来协调腾讯云多个服务与资源的任务编排，为分布式任务执行提供全托管的云服务平台，大
幅简化运行多个云服务所需要的任务协调、状态管理及错误处理等繁琐工作，让用户聚焦业务逻辑开发，以智能化编排提升企业工作效能\cite{jydyyybp}。

根据功能单一职责，高内聚低耦合的原则划分为数个微服务，使用容器托管平台进行执行容器管理，构成一个具有高可用、高容错特性的云服务系统。
项目是依托于腾讯云基础设施以及公有云上现有的业务作为资源而立项的一个云服务系统，为此，需将项目所在的平台和依赖的资源做一个粗略的介绍。


\subsection{名词解释}

DAG：全称Direct Acyclic Graph，即有向无环图，以下简称DAG。由于有向无环图的定义就是没有环的存在，从一个起始节点出发，不会产生环路，
这正符合工作流的定义，工作流必须保证能在规定时间内完成执行，因此不得出现用户输入的工作流是一个带环的图。

因此，在本文中采用DAG来描述一个工作流正合适不过。这个图的每个节点，以一段TCSL定义来唯一表示。系统也通过解析DAG以及TCSL的内容，从而
知晓用户的意图，执行具体的任务。

QRN：全称Query Resource Name，即查询资源定位符，形如qrn:asw:ap-shanghai:654321:sdk:asr:convertToText，以冒号分隔不同
的字段，qrn代表后续字符是用来描述一个QRN；asw代表该应用与服务编排系统；ap-shanghai代表资源的地域是上海；654321代表用户的uid；sdk代表
该QRN调用公有云的SDK中的某个包；asr代表服务的缩写，全称Automatic Speech Recognition，即调用语音识别算法；
convertToText是该算法中的具体函数，这是将语音转化为文本的函数。综上，这是一个资源QRN。同样地，还有工作流QRN，以及执行机器QRN，前者
代表一个工作流对象，后者用于表示执行时生成的标识符，便于在执行记录中定位。


\subsection{结构化状态语言}

腾讯云状态语言（Tencent Cloud States Language，以下简称TCSL），是基于 JSON 的结构化语言，用来描述和定义工作流中的业务逻辑。
在执行时，ASW 工作流服务会根据工作流定义依次执行相关步骤。TCSL可以定义一个工作流的属性以及其包含节点的属性。

\subsubsection{支持字段}

字段	描述
Type（必填）	节点的类型。目前支持的节点类型为：Pass、Task、Choice、Parallel、Map。
Next （二选一）	当前节点运行完毕后，下一个运行的节点名称。某些节点类型（例如 Choice 节点）内部支持多个 Next 节点。
End（二选一）	如果设定 End 参数为 true，那么这个节点就是工作流的最后一个执行节点。一个节点只可以定义 Next 或 End。
Comment（可选）	节点的描述信息。
InputPath（可选）	用于选择传递到节点进行处理的数据。如果省略，它的值为 \$，表示指定整个输入。
OutputPath（可选）	用于选择节点处理后的输出数据。如果省略，它的值为 \$，表示指定整个输出。


\subsubsection{节点}
节点是工作流的一个基本单元\cite{jyrq}。每个节点接收输入数据，对数据进行操作处理后 ，将输出数据传递给向下一个节点。
节点可以是简单的原子节点，如 Pass 节点、Task 节点；也可以是复杂的逻辑控制节点，如 Choice 节点、Map 节点、Parallel 节点。
节点的组合使用构建了复杂的业务逻辑。有关节点的类型，后面会进一步说明。

工作流中的节点规则如下：

节点在 States 定义中可以按任意顺序出现，它们出现的顺序不会影响到它们的运行顺序。运行顺序由节点的 Next 字段所构成的逻辑决定。
在工作流中，只能有一个初始执行节点，它由顶级结构中 StartAt 字段的值指定\cite{jysrv6}。
根据您的工作流逻辑，您可能会有多个结束节点（例如工作流有多个执行分支时）。
如果工作流只包含一个节点，该节点可以为 start 状态和 end 节点。



一个通过TCSL状态语言描述的示例如下：
\{
    "Comment": "使用Pass节点演示hello world示例",
    "StartAt": "Hello",
    "States": \{
    "Hello": \{
        "Type": "Pass",
        "Comment": "传递",
        "Next": "World"
    \},
    "World": \{
        "Type": "Pass",
        "Comment": "传递",
        "End": true
    \}
\}
\}

该示例中描述了一个含有两个节点的工作流，即States数组字段中，名称为Hello、World两个节点，该工作流的起始节点是StartAt字段指定名称为
Hello的节点，Comment字段是为该工作流添加的注释，执行时忽略。在States字段声明的节点中，Type字段为Pass代表这是一个类型为传递的节点，
Next代表指明该节点执行完后，应执行哪一个节点，如果含有End字段为真（True），则代表该节点是最后的节点。End与Next在每个节点的内容中
必包含一个，否则后台解析将会报错。

进一步地，节点类型Type字段可选的枚举值有如下几种：
\begin{itemize}
    \item Task：使用Task节点来定义工作流调用的云服务资源信息，执行Task节点会调用相应的资源。
    \item Pass：使用Pass节点来输出常量或者将输入转换成期望的输出。通常用于构造和调试工作流。
    \item Choice：使用Choice节点让工作流根据条件执行不同分支节点。
    \item Parallel：使用Parallel节点并行执行多个不同分支节点。
    \item Map：使用Map节点并行执行多个相同的节点，功能等同于循环。
\end{itemize}



\section{相关技术介绍}

%\subsection{Redis}
%Redis是一个高性能的NoSQL型Key-Value数据库，不同于传统的关系型数据库具有行列结构，Redis使用键值对来存储数据，具有易扩展，高性能，
%高可用，灵活的特点。但也区别于关系型数据库可以保证关系数据ACID特性，在对部分区间值进行查询或更新操作时效率可能较为低下。
%
%项目依托TDSQL云服务，其底层是由Redis搭建的集群，提供稳定的Redis服务，可以根据需求进行资源申请和动态弹性扩容。
%
%\subsection{MySQL}
%MySQL是一个RDBMS (Relational Database Management System，关系数据库管理系统)，是最流行的关系型数据库管理系统之一。同其它的大型
%数据库相比，MySQL具有开源、易用、灵活、高性能、可移植的特点。
%
%MySQL支持InnoDB、MyISAM等数种存储引擎。由于InnoDB支持ACID事务，支持行级锁定等特性，即使不如MyISAM拥有较高的查询、插入速度，但还是
%自MySQL 5.5起使用InnoDB作为默认的数据库引擎。


\subsection{Kubernetes}
Kubernetes（以下简称K8s），是一种可自动实施Linux容器操作的开源平台。

K8s通过将手动部署的过程简化和扩展操作，来达成屏蔽底层逻辑的目
的，用户仅需使用平台提供的API即可高效地管理Docker容器。并且，K8s提供跨公有云、私有云或混合云部署主机集群。对本文此种需要横向快速扩
展的云原生应用来说，K8s是一个合适的容器托管平台选择\cite{zhong2021machine}。

项目依托底层由kubernetes管理搭建的云容器管理平台，在其上层部署项目的微服务，支持统一的可视化界面管理，容器节点状态查询，配置管理，
节点负载动态弹性扩容等功能\cite{Tuli_2022}。

\subsection{日志云服务}
项目需要存储大量的系统工作日志和用户工作流执行日志，根据系统架构设计，通过解耦的方式，将该部分功能分离至单独的模块，该模块主要是
通过对接公有云服务之一的CLS日志服务来辅助实现大量数据写入存储\cite{othe1}。

日志服务（Cloud Log Service，CLS）是一种一站式的日志数据解决方案。无需关注扩缩容等资源问题，五分钟快速便捷接入，即可使用日志采集、
日志存储到日志内容搜索、统计分析等全方位稳定可靠的日志服务。 可以方便地进行业务问题定位，指标监控、安全审计等操作，降低日志运维门槛。



%\subsection{Docker}
%Docker是一个开源的软件项目，是云服务的一次重大创新。相比于传统虚拟机技术，Docker利用了Linux核心的资源分脱机制和命名空间分割，可以
%创建独立的软件容器。以此为基础，可以使其具有更快的启动速度，更高效的资源利用率，更轻松的维护和迁移的特性。
%
%\subsection{Golang}
%Go语言（或 Golang）起源于 2007 年，并在 2009 年正式对外发布。Go 是非常年轻的一门语言，它的主要目标是“兼具 Python 等动态语言的开发
%速度和 C/C++ 等编译型语言的性能与安全性”。
%
%Go语言是编程语言设计的又一次尝试，是对类C语言的重大改进，它不但能让你访问底层操作系统，还提供了强大的网络编程和并发编程支持。Go语言
%的用途众多，可以进行网络编程、系统编程、并发编程、分布式编程。
%
%Go语言的推出，旨在不损失应用程序性能的情况下降低代码的复杂性，具有“部署简单、并发性好、语言设计良好、执行性能好”等优势，目前国内诸多
%IT公司均已采用Go语言开发项目。
%
%Go语言由于自身携带的诸多特性，可以用面向过程的思想编写多线程程序，开发效率高，因此是一个很适合用于编写微服务业务模块的语言。


%\subsection{Gin框架}
%Gin是一个Golang编写的微框架，具有高性能、轻便、易维护的特点。Gin采用了HttpRouter第三方包作为替代原生net/http包的实现，速度提升了接
%近40倍[1]，且拥有错误管理、路由管理、高可扩展性等较多易用的特性。本文采用其作为服务器后台搭建的框架，也可以将容器镜像的包大小进一步
%压缩。
%
%\subsection{Flask框架}
%Flask是一个用Python编写的Web应用程序框架。由于其简易性，也被称为微框架，"微"体现了微框架的目标是保持核心简单而又可扩展。可以每个
%业务场景的不同，使用extension增加其他功能，即可以如同Flask原生一样来使用这些附加功能。大量的扩展用以支持数据库整合、表单验证、鉴权验证和数据上传
%等，几乎可以涵盖一切场景的业务交互场景。

%
%\subsection{Nginx}
%Nginx是一个开源的高性能HTTP和反向代理服务器。同时也支持IMAP/POP3/SMTP协议等服务。其使用场景包括搭建独立的HTTP服务器，反向代理，负
%载均衡等。本文采用Nginx来搭建一个前后端分离的反向代理服务器，将Internet的用户请求转发到内部服务器，而无需暴露内部具体机器IP地址，可
%以低成本进行服务器容量扩展。

