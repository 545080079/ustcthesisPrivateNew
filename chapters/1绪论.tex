%! Author = Administrator
%! Date = 2021/7/2

\chapter{绪论}

%\section{一级节标题}
%

%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

%cd pdf2word
%python3 -m venv venv
%source venv/bin/activate
%python main.py

%latexmk -xelatex main.tex
%如需清理论文编译过程中的临时文件，可以：
%
%latexmk -c

%所需UML图清单：
%·时序图
%模块：
%模板
%调度
%执行
%鉴权

%接口：
%应用模板工作流StartDeploy:app-template-sx-1.png
%√工作流执行StartExecution：start-execution-1.png
%√CLS写：cls-1.png
%DescribeToken
%应用模板接口: template-app-1.png

%
%·架构图
%√总体架构：3-1.jpg、asw-2.png
%√执行器架构 1张
%
%·用例图
%用户交互用例 1张

%压测图
%压测计划：test-plan.png、test-plan-2.png
%压测情况：6-3-1.jpg



%\subsection{二级节标题}
%
%\subsubsection{三级节标题}
%
%\paragraph{四级节标题}
%
%\subparagraph{五级节标题}

\section{选题背景及研究意义}
%云计算涌现出很多改变传统IT架构和运维方式的新技术，比如虚拟机、容器、微服务，无论这些技术应用在哪些场景，降低成本、提升效率是云服务永恒的主题。

随着云计算和弹性计算业务的不断发展，可以看出目前程序运行效率不仅仅取决于并发程序设计的好坏，而是可以通过云服务的弹性计算调度，来针对某些实际场景
提供更高效的服务\cite{wfwbpyy}。

\cite{wlfwyh}
由于云服务场景中，通用云能力的用户通常给定任务的数量庞大，有许多任务的执行计划是有明显的性能瓶颈处，执行到此处的时候会使容器负载陡增，严重时击垮集群，而大部分任务，
由于在等待前置任务的完成，都处于阻塞状态，无法得到执行。如果能试图找到一种方式，可以摆脱前置任务的等待，直接使其执行后置任务，提前得出结果，
将会大大增加容器的利用率以及整体服务的效率。并且，由于状态机种类是基于模板直接使用，或基于模板改造使用的，具有可预测性，因此，这种方式很具有实际工业价值。
同样，对系统关键节点的改动，往往牵一发动全身，整体系统的性能要进一步地优化，才能解决上述提到的问题。
\cite{jywfbpxt}
因此，设计同类系统的关键，在于如何处理好性能与成本的平衡，如何用最优的方案提供一种通用的服务，解决大多数客户的实际场景会遇到的问题，这也是本次需要
着重探讨的主题。


\section{国内外研究现状}

本章将从以下几个角度对竞品进行详尽的调研分析：
\begin{enumerate}
    \item 目前市面上有哪些工作流产品？目前的情况是怎么样的
    \item Step Function的落地场景有哪些
    \item 对腾讯云来说，ASW产品的价值与定位？与市面上已有的产品对比，怎样体现优势与差异化
    \item ASW潜在的客户场景与版本规划
\end{enumerate}

\subsection{竞品分析}

容器调度编排的云服务，国内外的各大云厂商 Amazon、微软、Google、IBM、阿里云、腾讯云、华为云相继推出了类似的Serverless产品。

Step Function

该产品旨在将多种 AWS 服务协调到无服务器工作流中，可以快速构建和更新应用程序\cite{jywfbpxt}。

对于Step Functions产品，是一个串联起亚马逊Lambda函数等所有主流服务的一个枢纽管理服务，在整个云服务体系具有举重若轻的作用，提供了一
种高效的业务应用快速构建的解决方案，以配置的形式指导生成代码，通用化、轻代码化，具有一定的先进性和实用性，但仍有执行缓慢，响应不及时
的问题，究其原因，是系统采用串行执行的方式，大量的容器节点在等待任务，而并非在计算，花在等待的时间太长，用户体验自然受到影响
\cite{jybpmsyc}。因此，优化效率，是支撑目前日益增长的业务场景需求量所不可避免的关节问题。

工作流模式
\begin{itemize}
    \item 标准工作流：非常适合长时间运行、持久且可审计的工作流。它们最多可以运行一年，Step Functions API则可以检索完整的执行历史记录，最长可达执行完成后 90 天。标准工作流采用至少一次模型，其中，除非您在 ASL 中指定了Retry行为，否则您的任务和状态绝不会执行多次。这使其适合编排非静态操作，例如启动 Amazon EMR 集群或处理付款。标准工作流执行将根据处理的状态转换次数计费。
    \item 快速工作流：非常适合大批量的事件处理工作负载，例如 IoT 数据提取、流数据处理和转换以及移动应用程序后端。它们最多可以运行五分钟。快速工作流使用至少一次模型，在这种模型中可能会运行多次执行。这使得它们非常适合编排幂等操作，例如转换输入数据和通过 PUT 存储到 Amazon DynamoDB 中。快速工作流的执行按执行次数、执行持续时间和消耗的内存计费。
\end{itemize}


标准工作流和快速工作流的对比：

优点

亚马逊云的step-function是2016年12月推出。凭借云平台和lambda函数的HA特性，可以轻松地无限扩展（与其他产品相比）。
它还为通用工作流处理提供了一些有用的功能，如等待支持和基于输出的动态分支。
它也相当便宜：如果你没有运行成千上万的工作，这可能比运行你自己的集群更好。

缺点

\begin{itemize}
    \item 只能由AWS用户使用。
    \item Lambda需要额外的工作来进行生产级迭代/部署。
    \item 调试步骤不方便。
    \item 如果你需要任何级别的监控，你需要自己使用cloudwatch构建它。
\end{itemize}


\begin{table}[H]
\centering
\caption{竞品对比表}
\label{tab:compare-1}
\begin{tabular}{lllllll}
\toprule
&Airflow	&Azkaban	&Conductor	&Oozie	&Step Function	&Serverless \\
\midrule
所属公司& Apache& LinkedIn& Netflix& Apache& 亚马逊& 阿里巴巴 \\
发布时间&	7年&	10年&	4.5年&	11年&	4.5年&	1.5年 \\
产品定位&	批处理&	Hadoop&	微服务编排&	Hadoop&	通用&	通用 \\
流程定义&	Python&	自定义DSL&	JSON&	XML&	JSON&	YML \\
支持单节点&	是&	是&	是&	是&	N / A&	N / A \\
快速演示设置&	是&	是&	是&	否&	N / A&	N / A \\
支持HA&	是&	是&	是&	是&	是&	是 \\
单点故障&	是&	是&	否&	否&	否&	否 \\
Cron Job&	是&	是&	没有&	是&	是&	是 \\
执行模型&	推送&	推送&	轮询&	轮询&	未知&	未知 \\
Rest API触发器&	是&	是&	是&	是&	是&	否 \\
参数化执行&	是&	是&	是&	是&	是&	是 \\
由外部事件触发&	是&	否&	没有&	是&	是&	是 \\
本机等待任务支持&	是&	否&	是&	没有&	是&	是 \\
回填支持&	是&	否&	否&	是&	否&	否 \\
本机Web身份验证&	LDAP /密码&	XML密码&	否&	否&	否&	否 \\
监控&	是&	有限&	有限&	是&	有限&	有限 \\
可扩展性&	一般&	好&	很好&	很好&	很好&	一般\\
\bottomrule
\end{tabular}
\end{table}

如上表1-x提到的几种同类产品，根据这些技术实现上的不同，都产生了不同的优势和劣势。

%Airflow
%
%优点：Airflow与所有其他解决方案相比，Airflow是一种功能超强的引擎，你不仅可以使用插件来支持各种作业，包括数据处理作业：Hive，Pig（尽管你也可以通过shell命令提交它们），以及通过文件/ db entry / s3来触发的一般流程管理，或者等待来自Web端点的预期输出，但它也提供了一个很好的UI，允许你通过代码/图形检查DAG（工作流依赖性），并监视作业的实时执行。
%目前充满活力的社区也可以高度定制Airflow。你可以使用本地执行程序通过单个节点运行所有作业，或通过Celery / Dask / Mesos编排将它们分发到一组工作节点。
%
%缺点：airflow本身仍然不是很成熟（实际上Oozie可能是这里唯一的“成熟”引擎），调度程序需要定期轮询调度计划并将作业发送给执行程序，这意味着它将不断地从“盒子”中甩出大量的日志。
%由于它通过定期轮询工作，工作不能保证实时安排，随着并发工作数量的增加，会更加无法满足预期。
%
%同时，由于你有一个集中式调度程序，如果它出现故障，正在运行的作业将不会像执行程序的作业那样受到影响，但是不会安排新的作业了。当调度程序
%因任何原因而卡住时，你在Web UI中看到的所有任务都在运行， 但实际上它们实际上并没有向前运行，而执行程序的视角看来执行并没有问题。
%
%从初看起来，Web UI非常好用，然而，它有时会让新用户感到困惑，因为其给出的专业性名词缩写较多，比如DAG运行是什么样一种概念，任务为什么没有状态，
%图表的搜索功能也较为简单， 更不用说一些功能还远远没有详细记录。
%回填设计在某些情况下是好的，但在其他情况下非常容易出错。如果你的cron计划已禁用并且稍后重新启用，那么它会尝试追赶，如果你的工作不是幂
%等的，那么就会发生真实的无可挽回的事情\cite{jybpsjpm25}。
%
%Azkaban
%
%优点：在所有引擎中，Azkaban可能是最容易开箱即用的。UI非常直观且易于使用。调度和REST API工作得很好。
%
%有限的HA设置开箱即用。不需要负载均衡器，因为你只能有一个Web节点。你可以配置它如何选择执行程序节点然后才能将作业推送到它，它通常看起
%来非常好，只要有足够的容量来执行程序节点，就可以轻松运行数万个作业。
%
%缺点：作为通用编排引擎，它没有非常丰富的功能，但可能不是最初设计的目的，它的优势在于对Hadoop / Pig / Hive的原生支持，尽管也可以使用
%命令行实现这些功能，但它本身不能通过Airflow等外部资源触发工作，也不支持工作等待模式。虽然你可以通过java代码/脚本实现比较繁忙的
%工作，但这会导致资源利用率下降。
%
%与其他文档和配置相比，文档和配置通常有点混乱。它可能不应该推荐为初学者使用，设计很好但是你最好有一个大型数据中心来运行执行程序，
%因为当执行程序耗尽资源而没有额外的监视功能时，调度会停止。与其他代码相比，整体代码质量有点朝向低端，所以它通常只有在资源不成问题时才能很好地扩展。
%\cite{jybpmsyc}
%设置界面较为不友好。用户希望拥有稳定的裸机，而不是动态分配具有动态IP的虚拟实例。 但是，如果你的机器负载很重，它通常不会很好，因为端点可能会卡住。
%
%Conductor
%
%优点：Conductor的设计初衷是微服务编排，无论这意味着什么，它的HA模型涉及一定数量的服务器，它们位于负载均衡器后面，将任务放入消息队列中，
%工作节点将轮询这个队列，这意味着你不太可能遇到停滞的调度。在API参数化执行的帮助下，如果你正确设置负载均衡器/服务发现层，Conductor非常擅长调度和扩展。
%
%缺点：用户界面需要更多的提高，目前监控非常有限。虽然通用调度可能已经足够好了。
%
%这是开箱即用的裸机。甚至没有运行shell脚本的本机支持，尽管通过python实现任务工作者很容易通过提供的示例完成工作。
%\cite{jypaas}
%Oozie
%
%优点：Oozie通过db设置提供了一个可靠的HA模型，它为Hadoop相关工作提供本机支持，因为它是为该生态系统构建的\cite{jygjbp}。
%
%缺点：对于通用流程调度而言，不是一个非常好的候选者，因为XML定义对于定义轻量级作业非常冗长和繁琐。
%
%它还需要相当多的外设设置。你需要一个zookeeper集群，一个db，一个负载均衡器，每个节点都需要运行像Tomcat这样的Web应用程序容器。
%初始设置也需要一些时间，这对初次使用的用户来说是不友好的。


综上，即使相关产品的种类较多，在有需求使用云服务时，往往需要对比好几家云服务供应商，再在供应商提供的琳琅满目的服务中挑选相关的整合起来，将
自己的业务需求相关信息部署到这几个挑选好的服务中，逐一申请开通，并进行测试。这一流程是消耗大量时间的。因此，本设计的初衷，就是解决这
种低效率的流程，解决上述产品所薄弱的环节，将所有现有的服务串起来，形成一个整体，用户无需在各大供应商之间频繁切换，用户可以随时、
低成本地创建、变更业务流程，快速地在云上部署业务，一站式解决繁琐的操作流程问题\cite{jydyyybp}。

但是，这种云集成式的应用编排服务，在解决了上述问题的同时，也增加了一个新的问题，即如何保证将这么多服务组合在一起，统一地进行资源管理和调度管理后，
如何保证执行的效率以及响应速度。

本文是依托于腾讯云的基础能力设施，构建的ASW（应用与服务编排工作流，Application Service Workflow）云服务，基于此系统[5]，加以进行改进，而产生的一种
应用与服务编排调度服务。主要解决的问题是如何统一地管理繁多的流程和资源编排步骤，提供稳定高效的云服务编排执行服务。
目的是为了在云服务平台提供一个统一的接口，让本系统作为用户使用云服务复杂场景时的第一选择。

优势：

支持全量云服务
ASW 支持全量腾讯云产品服务的编排调度，即 云API 支持的所有产品服务，包括 AI 服务、云函数、Severless 服务等。
通过任务调度多个服务产品，完成复杂业务应用编排场景。

低代码
ASW 为您管理应用程序的逻辑，并实施基本控制单元，例如分支，并行，循环等，减少您在业务中实现重复的编排代码。

高容错
ASW 为您管理状态、检查点和重启，以确保您的应用程序按照预期逐步执行。内置 try/catch、重试和回滚功能自动处理错误和异常。

自动兼容
ASW 通过 云API 调度云产品服务的编排，并具备自动更新云 API 的能力，因此能自动兼容云产品功能的升级和迭代。

无限扩展
ASW 凭借云平台和云函数的 HA 特性，可以轻松地无限扩展，具备兼容公有云，私有云，自建服务的融合能力。

可视化监控
ASW 提供可视化界面来定义工作流和查看执行状态。状态包括输入和输出等。方便您快速识别故障位置，并快速排除故障问题。


本产品计划提供的一些落地场景参考：

    \begin{itemize}
        \item 机器学习训练
        \item 消息时间处理：设定消息源，按topic分发消息，推送到手机
        \item 视频切片转码：上传+云函数+输出
        \item lambda批数据处理
    \end{itemize}



\subsection{本论文的主要工作}

由于公有云业务本身的特点是业务流程简单，但数据量庞大，本系统的目的是整合所有的云业务进行统一编排管理，\footnote{脚注内容}

为了应对大流量的挑战，高性能、高可用的设计是必要的。主要包括：数据库性能效率瓶颈，如何在保证正确性的前提，最大化执行的效率；中间件的种类，如何
选择适合系统的中间件模块；执行器模块性能瓶颈，如何设计一个高可用的执行器，在可能的时候，如何支持并发执行任务；
海量数据如何持久化存储的；网络输入流量较大，如何保证消息队列能够及时处理消费任务。以上，是本次需要探讨主要的问题。
致力于设计适用于大部分场景，满足大部分客户需要的一种智能化编排应用与服务的系统，提供高效的工作流编排执行服务。

\subsection{本文的组织结构}
本文主要分为七个章节，每个章节的具体内容安排如下：

第一章：绪论： 介绍当前云计算的发展，包括容器编排调度的市场发展现状和本论文研究的内容。

第二章：需求分析： 通过对应用服务编排系统的国内外公司相似产品进行调研，以及公司现有的公有云体系设计相结合，针对系统的需求分析进行阐述。

第三章：概要设计： 该部分对需求进行具体的梳理，划分出各个功能模块和整体的系统架构。包括各个模块之间的数据流转、相互协作等。通过该部分的概要设计，可以为具体的系统实现提供工程上的依据和铺垫。

第四章：详细系统设计与实现： 基于上一章提出的设计方案，与软件工程的基本原则和设计思想结合，对前端后端通信，后端模块与模块通信，后端与数据层通信的具体业务逻辑实现以及数据库设计进行了详细的阐述。

第五章：系统测试与分析： 基于测试驱动开发的思想，在本章提出了交付的指标要求和具体测试方式，对整个系统的功能性、稳定性、并发性、可用性等多维度进行评价，确保该系统改进的有效性，是否可以满足预期结果。

第六章：总结与展望：对本篇论文进行了简单的总结和展望，以及本篇论文所设计的系统进行了宏观上的描述和审视，提出了未来的改进计划以及展望。


